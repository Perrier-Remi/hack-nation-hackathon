# Veo 3.1 API Spec Compliance

## âœ… Implementation Status

Our `VeoEnhancer` class is now fully compliant with Google's official Veo 3.1 API specification.

## ðŸ“‹ Required Parameters (Veo 3 Models)

### âœ… `durationSeconds` - **REQUIRED**
- **Type**: Integer
- **Allowed Values**: `4`, `6`, or `8` seconds
- **Implementation**: âœ… Passed as integer (not string)
- **Validation**: âœ… Validates and defaults to 8 if invalid value provided
- **Code**: `duration_seconds=duration`

### âš ï¸ `generateAudio` - **NOT SUPPORTED in Python SDK**
- **Type**: Boolean (in REST API only)
- **Value**: `true` (Veo 3.1 natively generates audio)
- **Implementation**: âŒ NOT included in Python SDK (raises ValueError if used)
- **Note**: Veo 3.1 always generates audio automatically - cannot be disabled
- **Code**: Omit this parameter entirely

## ðŸŽ¨ Resolution & Format

### âœ… `resolution` - **Veo 3+ Only**
- **Allowed Values**: `"720p"` or `"1080p"`
- **Default**: `"720p"`
- **Implementation**: âœ… Supports both, validated
- **Code**: `resolution=resolution`

### âœ… `aspectRatio`
- **Allowed Values**: `"16:9"` (default) or `"9:16"`
- **Implementation**: âœ… Currently set to `"16:9"`
- **Code**: `aspect_ratio="16:9"`

## ðŸ“¸ Reference Images

### âœ… `referenceImages` - Up to 3 Asset Images
- **Maximum**: 3 images per video
- **Supported Type**: `"asset"` only
- **NOT Supported**: `"style"` type (not supported in Veo 3.1)
- **Implementation**: âœ… Uses up to 3 keyframes with `reference_type="asset"`
- **Code**:
```python
types.VideoGenerationReferenceImage(
    image=img,
    reference_type="asset"  # Only "asset" supported for Veo 3.1
)
```

## ðŸ”¢ Video Count

### âœ… `sampleCount`
- **Type**: Integer
- **Range**: 1-4 videos
- **Implementation**: âœ… Set to `1`
- **Code**: `sample_count=1`

## ðŸš« Negative Prompts

### âœ… `negativePrompt` - Optional
- **Type**: String
- **Purpose**: Describe what NOT to include
- **Implementation**: âœ… Supports custom negative prompts
- **Default**: `"blurry, low quality, distorted, pixelated, grainy, amateur, poor lighting, watermark"`
- **Code**: `negative_prompt=negative_prompt`

## ðŸŽ¬ Model Selection

### âœ… Model Name
- **Current**: `"veo-3.1-fast-generate-preview"`
- **Alternative**: `"veo-3.1-generate-preview"` (slower but potentially higher quality)
- **Implementation**: âœ… Using fast preview for better performance

## ðŸŽµ Audio Generation

Veo 3.1 **automatically** generates audio for all videos - this cannot be disabled:
- **Dialogue**: Use quotes for speech (e.g., "This is the key," he said)
- **Sound Effects**: Explicitly describe (e.g., tires screeching, engine roaring)
- **Ambient Noise**: Describe soundscape (e.g., faint hum, birds chirping)

### Implementation
- âŒ `generateAudio` parameter NOT supported in Python SDK (raises ValueError)
- âœ… Audio is always generated by default for Veo 3.1
- âœ… Prompts include audio cues: "Ambient background music with clear, professional audio mixing"

## ðŸ“Š Complete API Call Example

**Note**: Python SDK uses camelCase parameter names, not snake_case!

**Important**: `generateAudio` is NOT supported in the Python SDK (Veo 3.1 always generates audio)

```python
operation = self.client.models.generate_videos(
    model="veo-3.1-fast-generate-preview",
    prompt=full_prompt,
    config=types.GenerateVideosConfig(
        referenceImages=reference_images,       # Up to 3 asset images (camelCase!)
        aspectRatio="16:9",                     # "16:9" or "9:16"
        resolution=resolution,                  # "720p" or "1080p"
        durationSeconds=duration,               # Integer: 4, 6, or 8 (REQUIRED)
        numberOfVideos=1,                       # 1-4 videos (camelCase!)
        # generateAudio: NOT supported in Python SDK (always enabled for Veo 3.1)
        negativePrompt=negative_prompt,         # Optional (camelCase!)
    ),
)
```

## âš ï¸ Key Changes from Previous Implementation

1. **Fixed `durationSeconds`**: Changed from `str(duration)` â†’ `duration` (integer)
2. **Removed `generateAudio`**: NOT supported in Python SDK (Veo 3.1 always generates audio by default)
3. **Fixed parameter names**: Python SDK uses **camelCase** (e.g., `numberOfVideos`, not `sample_count`)
4. **Added validation**: Duration must be 4, 6, or 8
5. **Added resolution support**: Can now specify "720p" or "1080p"
6. **Added negative prompts**: Default negative prompt for quality control
7. **Updated documentation**: Class docstring now includes full spec

### Important: Python SDK Parameter Naming & Limitations
The Python SDK uses **camelCase** for all parameters:
- âŒ `duration_seconds` â†’ âœ… `durationSeconds`
- âŒ `sample_count` â†’ âœ… `numberOfVideos`
- âŒ `reference_images` â†’ âœ… `referenceImages`
- âŒ `aspect_ratio` â†’ âœ… `aspectRatio`
- âŒ `negative_prompt` â†’ âœ… `negativePrompt`

The Python SDK does NOT support `generateAudio`:
- âŒ `generateAudio=True` â†’ Raises ValueError
- âœ… Omit parameter (Veo 3.1 always generates audio)

## ðŸ“– Official Documentation References

1. **Veo 3.1 on Vertex AI**: https://cloud.google.com/vertex-ai/generative-ai/docs/video/generate-videos
2. **Gemini API - Veo Guide**: https://ai.google.dev/gemini-api/docs/video
3. **Veo Prompt Guide**: https://ai.google.dev/gemini-api/docs/video#prompt-guide
4. **Model Versions**: https://ai.google.dev/gemini-api/docs/video#model-versions

## ðŸ” Validation & Error Handling

```python
# Duration validation
if duration not in [4, 6, 8]:
    print(f"âš ï¸  Invalid duration {duration}s, using default 8s")
    duration = 8

# Resolution validation
if resolution not in ["720p", "1080p"]:
    print(f"âš ï¸  Invalid resolution {resolution}, using 720p")
    resolution = "720p"

# Default negative prompt
if not negative_prompt:
    negative_prompt = "blurry, low quality, distorted, pixelated, grainy, amateur, poor lighting, watermark"
```

## ðŸš€ Usage Example

```python
from pipeline.veo_enhancer import VeoEnhancer

# Initialize
enhancer = VeoEnhancer(video_hash="abc123")

# Enhance a scene
result = enhancer.enhance_scene(
    scene_index=0,
    enhancement_prompt="Improve lighting and add dynamic camera movement",
    duration=8,                    # 4, 6, or 8 seconds
    resolution="720p",             # "720p" or "1080p"
    negative_prompt="blurry, grainy"  # Optional
)

# Result includes:
# - status: "generated" or "failed"
# - enhanced_video_path: Path to MP4
# - reference_frames_count: Number of keyframes used
# - duration: Video duration
# - file_size_mb: Size of generated video
```

## âœ… Compliance Checklist

- [x] `durationSeconds` is an integer (4, 6, or 8)
- [x] `generateAudio` is NOT used (Python SDK doesn't support it - Veo 3.1 always generates audio)
- [x] `resolution` supports "720p" and "1080p"
- [x] `aspectRatio` is set to valid value ("16:9")
- [x] `numberOfVideos` is set (1-4) using correct camelCase name
- [x] `referenceImages` use type="asset" (not "style")
- [x] Up to 3 reference images used
- [x] `negativePrompt` supported
- [x] Model name is correct: "veo-3.1-fast-generate-preview"
- [x] Prompts follow Veo guidelines (Subject, Action, Style, Camera, Composition, Ambiance, Audio)
- [x] Audio cues included in prompts (Veo 3.1 generates audio automatically)
- [x] Error handling and validation implemented
- [x] All parameter names use camelCase (Python SDK requirement)

## ðŸŽ¯ Future Enhancements

### Not Yet Implemented:
- [ ] `personGeneration` parameter ("allow_all", "allow_adult", "dont_allow")
- [ ] `seed` parameter (for determinism)
- [ ] `aspectRatio` customization (currently fixed at "16:9")
- [ ] `image` parameter (image-to-video generation)
- [ ] `lastFrame` parameter (frame interpolation)
- [ ] `video` parameter (video extension)
- [ ] Multiple sample generation (`sample_count > 1`)
- [ ] 9:16 aspect ratio support (portrait mode)

These features are supported by the API but not yet exposed in our wrapper.

